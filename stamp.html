<!DOCTYPE HTML>
<html>
  <head>
	<title>Baby Stamps</title>
	<style>
		body {
			margin: 0px;
			padding: 0px;
		}
		#available-icons span {
			width:100px;
			height: 100px;
			border:5px solid white;
			display:inline-block;
		}
		#available-icons .selected {
			border:5px solid blue;
		}
	</style>
  </head>
  <body>
  	<div id="canvas-container">
  	</div>
	<div id="available-icons">
	</div>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script>
		(function($) {
			// set up the console logger
			if(!console){
				window.console = {};
			}
			if(!console.log){
				window.console.log = function(){};
			}
			
			// Manage the available images
			var imageManager = null;
			function ImageManager(data) {
				console.log("Loading image manager");
				this.images = {};
				this.categories = data.categories;
				this.images = data.images
				
				// Sets the category, will update the available images
				this.setCategory = function(category){
					console.log("Setting category to: " + category);
					$('#available-icons').html('');
					for(var i=0;i < data.images[category].length; i++){
						var img = data.images[category][i];
						$('#available-icons').append('<span><img src="'+img.src+'" alt="' + img.title + '" /></span>');
					}
					$('#available-icons span').click(function(){
						$('#available-icons span').removeClass('selected');
						$(this).addClass('selected');
					});
				};

				// load the default category
				this.setCategory(data.categories[0].name);
			}

			//Load the image JSON Data
			$.ajax({
				url: 'stamps.json',
				dataType: 'json',
				success: function(data){
					console.log("Loading the available stamps");
					imageManager = new ImageManager(data);
				},
				error: function(){
					console.log("Unable to load available stamps");
				}
			});
			
			var width = $(document).width();
			var height = $(document).height() - 130;
			$('#canvas-container').append('<canvas id="main-canvas" width="' + width + '" height="' + height + '"></canvas>');
			
			// get a reference to the canvas
			var canvas = document.getElementById('main-canvas');
			var context = canvas.getContext('2d');
			
			//handle clicks
			$(canvas).click(function(event){
				try{
					var imgObj = $('#available-icons .selected img')[0];
					context.drawImage(imgObj, event.pageX - 50, event.pageY - 50);
				}catch(e){
					console.log('Exception loading image: '+e.message);
				}
			});
		})(jQuery);
		
	</script>
	
  </body>
</html>